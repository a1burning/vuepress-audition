---
title: 性能优化
tags: 
  - render
date: 2022-03-30
prev: ./01.md
next: ./03.md
sidebarDepth: 5
---

## 1. 什么是防抖和节流有什么区别？如何实现？

:::details 查看答案
- 防抖 —— 触发高频事件后 n 秒后函数只会执行一次，如果 n 秒内高频事件再次被触发，则重新计算时间。
- 节流 —— 高频事件触发，但在 n 秒内只会执行一次，所以节流会稀释函数的执行频率。

```js
// 防抖
function debounce(fn) {
    // 创建一个标记用来存放定时器的返回值
    let timeout = null
    return function() {
        // 每当用户输入的时候把前一个 setTimeout clear 掉
        clearTimeout(timeout)
        // 然后又创建一个新的 setTimeout, 这样就能保证输入字符后的 interval 间隔内如果还有字符输入的话，就不会执行 fn 函数
        timeout = setTimeout(() => {
            fn.apply(this, arguments) 
        }, 500) 
    }
}
```

```js
// 节流
function throttle(fn) {
    // 通过闭包保存一个标记
    let canRun = true
    return function() {
        // 在函数开头判断标记是否为 true，不为 true 则 return
        if (!canRun) return
        // 立即设置为 false
        canRun = false
        // 将外部传入的函数的执行放在 setTimeout 中
        setTimeout(() => {
            fn.apply(this, arguments)
            // 最后在 setTimeout 执行完毕后再把标记设置为 true(关键) 表 示可以执行下一次循环了。当定时器没有执行的时候标记永远是 false，在开头 被return 掉
            canRun = true
        }, 500)
    }
}
```
:::

## 2. 优化方法有哪些？

:::details 查看答案
### 通络通信优化
1. 使用CDN服务
      - 全局负载均衡，用户可以选择最佳接入点
      - 还有缓存系统，有命中率和回源率两个指标
2. 请求消耗
      - 资源合并，限制请求次数（雪碧图）
      - 域名分片：多域名
3. HTTP优化
      - 头部压缩：HTTP2
### 数据传输优化
1. 使用缓存（强缓存和协商缓存）
2. 数据压缩
    - 数据压缩：gzip
    - 代码文件压缩：html/js/css、webpack框架
    - 静态资源
          + 字体图片换成字体图标
          + 去除图片元数据exif
          + 缩小图片尺寸和分辨率
          + 使用jpg和webP格式
### js代码优化
1. 慎用全局变量：查找时间长，内存空间占用率高，污染全局
2. 缓存全局变量：无法避免要用全局变量时，可以提前缓存到变量中
3. 通过原型新增方法：避免直接在Vue构造函数内部添加方法
4. 避开闭包陷阱：防止使用不当造成的内存泄露
5. 避免属性访问方法使用：在构造函数里面尽量不要额外添加访问某个属性的方法，在外部可以直接访问
6. 声明变量的时候，如果可以直接用字面量，不要用new函数
7. 多使用块级作用域，减少作用域查找
8. 避免使用==，会有类型转换的额外开销

### 节点优化
1. 节点操作要避免重绘和回流
2. `document.createdocumentfragment()`方法创建了一虚拟的节点对象，可以合并DOM操作
3. 相同的节点用cloneNode方法直接操作会比重新创建要性能好
4. html要语义化，加强DOM解析
5. 多使用伪元素，减少js多DOM的查找遍历

### 框架语言优化
1. 能用computed尽量不要用watch
2. 可以使用keep-alive组件控制缓存组件的显示隐藏

### 框架方案优化
1. 服务端渲染方案可以解决首次白屏时间长，SEO不好的问题
2. 静态网站可以使用静态站点生成方法：SSG、Gatsby、Gridsome
:::